<!doctype html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Î¤ÏÎ¬Ï€ÎµÎ¶Î± Î˜ÎµÎ¼Î¬Ï„Ï‰Î½ - eisatopon.gr</title>

  <!-- MathJax -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true
      },
      startup: {
        ready() {
          MathJax.startup.defaultReady();
          MathJax.startup.promise.then(() => {
            window.mathJaxReady = true;
          });
        }
      }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- QR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; color: #2c3e50; line-height: 1.7; }
    .main-wrapper { max-width: 1300px; margin: 0 auto; background: white; min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
    .header { background: #1565c0; color: white; padding: 50px 20px; text-align: center; border-bottom: 4px solid #0d47a1; }
    .header-icon { display: flex; gap: 8px; justify-content: center; align-items: flex-end; margin-bottom: 25px; }
    .book { width: 45px; height: 60px; border-radius: 4px; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.3); animation: float 3s ease-in-out infinite; }
    .book::before { content: ''; position: absolute; top: 0; left: 0; width: 8px; height: 100%; background: rgba(0,0,0,0.2); border-radius: 4px 0 0 4px; }
    .book::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 30px; height: 3px; background: rgba(255,255,255,0.4); }
    .book:nth-child(1) { background: linear-gradient(135deg, #e53935, #c62828); animation-delay: 0s; height: 55px; }
    .book:nth-child(2) { background: linear-gradient(135deg, #43a047, #2e7d32); animation-delay: 0.2s; height: 65px; }
    .book:nth-child(3) { background: linear-gradient(135deg, #1e88e5, #1565c0); animation-delay: 0.4s; height: 58px; }
    .book:nth-child(4) { background: linear-gradient(135deg, #fb8c00, #ef6c00); animation-delay: 0.6s; height: 62px; }
    .book:nth-child(5) { background: linear-gradient(135deg, #8e24aa, #6a1b9a); animation-delay: 0.8s; height: 60px; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
    .header h1 { font-size: 3em; margin-bottom: 10px; text-shadow: 3px 3px 6px rgba(0,0,0,0.4); color: white !important; }
    .header p { font-size: 1.3em; opacity: 0.95; color: white !important; }

    .content { padding: 40px 30px; }
    .section-title { font-size: 1.8em; color: #1565c0; margin: 40px 0 20px; padding-bottom: 10px; border-bottom: 4px solid #1976d2; }

    .filters { background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
    .filter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; }
    .filter-item label { font-weight: 600; color: #0d47a1; margin-bottom: 8px; display: block; }
    select { padding: 12px 16px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 1em; width: 100%; }
    select:focus { outline: none; border-color: #1976d2; box-shadow: 0 0 0 4px rgba(25,118,210,0.15); }

    .filter-actions { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    .btn { padding: 12px 32px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-primary { background: #1976d2; color: white; }
    .btn-primary:hover { background: #1565c0; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(25,118,210,0.3); }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-success { background: #388e3c; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-sm { padding: 8px 18px; font-size: 0.9em; }
    .btn-outline { background: white; border: 2px solid #1976d2; color: #1976d2; }
    .btn-outline:hover { background: #1976d2; color: white; }

    .results-info { background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center; font-weight: 600; color: #0066cc; margin-bottom: 25px; }
    .questions-grid { display: grid; gap: 25px; }

    .question-card { background: white; border: 2px solid #e9ecef; border-radius: 12px; padding: 30px; box-shadow: 0 3px 12px rgba(0,0,0,0.08); transition: all 0.3s; }
    .question-card:hover { border-color: #1976d2; transform: translateY(-5px); box-shadow: 0 10px 25px rgba(25,118,210,0.2); }
    .card-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
    .card-badges { display: flex; gap: 8px; flex-wrap: wrap; }
    .badge { padding: 6px 14px; border-radius: 25px; font-size: 0.85em; font-weight: 600; }
    .badge-year { background: #e3f2fd; color: #1976d2; }
    .badge-school { background: #fff3e0; color: #ef6c00; }
    .badge-subject { background: #e8f5e9; color: #388e3c; }
    .card-title { font-size: 1.4em; color: #0d47a1; margin: 15px 0; font-weight: 700; }
    .card-content { font-size: 1.05em; color: #2c3e50; line-height: 1.95; }

    /* Î Î±ÏÎ¬Î³ÏÎ±Ï†Î¿Î¹ */
    .exam-paragraph { margin: 14px 0; line-height: 1.95; }

    .empty-state { text-align: center; padding: 80px 20px; color: #999; }
    .empty-icon { font-size: 5em; opacity: 0.4; margin-bottom: 20px; }

    .my-exam-panel { border: 3px dashed #1976d2; border-radius: 12px; padding: 25px; background: #f4f8ff; min-height: 150px; }

    .footer { background: #0d47a1; color: white; text-align: center; padding: 25px; margin-top: 60px; font-size: 0.95em; }

    @media (max-width: 768px) {
      .filter-grid { grid-template-columns: 1fr; }
      .header h1 { font-size: 2.2em; }
    }
  </style>
</head>

<body>
<div class="main-wrapper">
  <div class="header">
    <div class="header-icon">
      <div class="book"></div><div class="book"></div><div class="book"></div><div class="book"></div><div class="book"></div>
    </div>
    <h1>Î¤ÏÎ¬Ï€ÎµÎ¶Î± Î˜ÎµÎ¼Î¬Ï„Ï‰Î½</h1>
    <p>eisatopon.gr â€“ Î Î±Î½ÎµÎ»Î»Î±Î´Î¹ÎºÎ­Ï‚ Î•Î¾ÎµÏ„Î¬ÏƒÎµÎ¹Ï‚ 1985-2025</p>
  </div>

  <div class="content">
    <div class="section-title">ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î˜ÎµÎ¼Î¬Ï„Ï‰Î½</div>

    <div class="filters">
      <div class="filter-grid">
        <div class="filter-item">
          <label>ğŸ“… ÎˆÏ„Î¿Ï‚</label>
          <select id="year">
            <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î­Ï„Î¿Ï‚</option>
            <option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option>
            <option value="2022">2022</option><option value="2021">2021</option><option value="2020">2020</option>
            <option value="2019">2019</option><option value="2018">2018</option><option value="2017">2017</option>
            <option value="2016">2016</option><option value="2015">2015</option><option value="2014">2014</option>
            <option value="2013">2013</option><option value="2012">2012</option><option value="2011">2011</option>
            <option value="2010">2010</option><option value="2009">2009</option><option value="2008">2008</option>
            <option value="2007">2007</option><option value="2006">2006</option><option value="2005">2005</option>
            <option value="2004">2004</option><option value="2003">2003</option><option value="2002">2002</option>
            <option value="2001">2001</option><option value="2000">2000</option><option value="1999">1999</option>
            <option value="1998">1998</option><option value="1997">1997</option><option value="1996">1996</option>
            <option value="1995">1995</option><option value="1994">1994</option><option value="1993">1993</option>
            <option value="1992">1992</option><option value="1991">1991</option><option value="1990">1990</option>
            <option value="1989">1989</option><option value="1988">1988</option><option value="1987">1987</option>
            <option value="1986">1986</option><option value="1985">1985</option><option value="1984">1984</option>
            <option value="1983">1983</option>
          </select>
        </div>

        <div class="filter-item">
          <label>ğŸ« Î¤ÏÏ€Î¿Ï‚ Î£Ï‡Î¿Î»ÎµÎ¯Î¿Ï…</label>
          <select id="school">
            <option value="">ÎŒÎ»Î±</option>
            <option value="gel">Î“Î•Î› Î—Î¼ÎµÏÎ®ÏƒÎ¹Î±</option>
            <option value="gel_repeat">Î“Î•Î› Î•Ï€Î±Î½Î±Î»Î·Ï€Ï„Î¹ÎºÎ­Ï‚</option>
            <option value="epal">Î•Î Î‘Î› Î—Î¼ÎµÏÎ®ÏƒÎ¹Î±</option>
            <option value="epal_repeat">Î•Î Î‘Î› Î•Ï€Î±Î½Î±Î»Î·Ï€Ï„Î¹ÎºÎ­Ï‚</option>
            <option value="omogeneis">ÎŸÎ¼Î¿Î³ÎµÎ½ÎµÎ¯Ï‚</option>
          </select>
        </div>

        <div class="filter-item">
          <label>ğŸ“– ÎœÎ¬Î¸Î·Î¼Î±</label>
          <select id="subject">
            <option value="">ÎŒÎ»Î±</option>
            <option value="ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬">ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬</option>
          </select>
        </div>

        <div class="filter-item">
          <label>ğŸ¯ Î˜Î­Î¼Î±</label>
          <select id="topic">
            <option value="">ÎŒÎ»Î±</option>
            <option value="A">Î˜Î­Î¼Î± Î‘</option>
            <option value="B">Î˜Î­Î¼Î± Î’</option>
            <option value="C">Î˜Î­Î¼Î± Î“</option>
            <option value="D">Î˜Î­Î¼Î± Î”</option>
          </select>
        </div>
      </div>

      <div class="filter-actions">
        <button class="btn btn-primary" onclick="searchQuestions()">ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</button>
        <button class="btn btn-secondary" onclick="resetFilters()">ğŸ”„ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬</button>
      </div>
    </div>

    <div class="results-info" id="resultsInfo" style="display:none;">
      Î’ÏÎ­Î¸Î·ÎºÎ±Î½ <strong id="resultsCount">0</strong> Î¸Î­Î¼Î±Ï„Î±
    </div>

    <div class="questions-grid" id="questionsGrid">
      <div class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <h3>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï†Î¯Î»Ï„ÏÎ± Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î¸Î­Î¼Î±Ï„Î±</h3>
      </div>
    </div>

    <div class="section-title">ğŸ§® Î¤Î¿ Î´Î¹Î±Î³ÏÎ½Î¹ÏƒÎ¼Î¬ Î¼Î¿Ï…</div>

    <div class="results-info" id="myExamInfo" style="display:none;">
      ÎˆÏ‡ÎµÏ„Îµ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ <strong id="myExamCount">0</strong> Î¸Î­Î¼Î±Ï„Î±
    </div>

    <div class="my-exam-panel" id="myExamPanel">
      <div class="empty-state">
        <div class="empty-icon">âœï¸</div>
        <h3>Î Î±Ï„Î®ÏƒÏ„Îµ Â«Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·Â» ÏƒÏ„Î± Î¸Î­Î¼Î±Ï„Î± Ï€Î¿Ï… Î¸Î­Î»ÎµÏ„Îµ</h3>
      </div>
    </div>

    <div class="filter-actions" style="margin-top: 15px;">
      <button class="btn btn-success btn-sm" onclick="printMyExam()">ğŸ–¨ï¸ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· PDF</button>
      <button class="btn btn-danger btn-sm" onclick="clearMyExam()">ğŸ—‘ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
      <button class="btn btn-primary btn-sm" onclick="generateQRCode()">ğŸ“± QR Code</button>
    </div>

    <div class="my-exam-panel" id="qrPanel" style="display:none; margin-top: 20px; text-align:center;">
      <h4 style="color:#0d47a1; margin-bottom:15px;">ğŸ“± QR Code Î³Î¹Î± ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ·</h4>
      <div id="qrcode"></div>
      <div style="color:#666; font-size:0.9em; margin-top:15px; word-break:break-all;">
        <strong>URL:</strong> <span id="shareUrl"></span>
      </div>
    </div>
  </div>

  <div class="footer">
    eisatopon.gr Â© 2025 â€“ Î¤ÏÎ¬Ï€ÎµÎ¶Î± Î˜ÎµÎ¼Î¬Ï„Ï‰Î½ Î Î±Î½ÎµÎ»Î»Î±Î´Î¹ÎºÏÎ½
  </div>
</div>

<script>
  const DATA_URLS = {
    "2025": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2025.json",
    "2024": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2024.json",
    "2023": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2023.json",
    "2022": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2022.json",
    "2021": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2021.json",
    "2020": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2020.json",
    "2019": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2019.json",
    "2018": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2018.json",
    "2017": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2017.json",
    "2016": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2016.json",
    "2015": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2015.json",
    "2014": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2014.json",
    "2013": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2013.json",
    "2012": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2012.json",
    "2011": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2011.json",
    "2010": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2010.json",
    "2009": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2009.json",
    "2008": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2008.json",
    "2007": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2007.json",
    "2006": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2006.json",
    "2005": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2005.json",
    "2004": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2004.json",
    "2003": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2003.json",
    "2002": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2002.json",
    "2001": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2001.json",
    "2000": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/2000.json",
    "1999": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1999.json",
    "1998": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1998.json",
    "1997": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1997.json",
    "1996": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1996.json",
    "1995": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1995.json",
    "1994": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1994.json",
    "1993": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1993.json",
    "1992": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1992.json",
    "1991": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1991.json",
    "1990": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1990.json",
    "1989": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1989.json",
    "1988": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1988.json",
    "1987": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1987.json",
    "1986": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1986.json",
    "1985": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1985.json",
    "1984": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1984.json",
    "1983": "https://raw.githubusercontent.com/Eisatopon/TRAPEZA-THEMATON/refs/heads/main/data/1983.json"
  };

  let allQuestions = [];
  let loadedYear = null;
  const selectedQuestions = [];

  function toGreekLetter(latin) {
    const map = { 'A': 'Î‘', 'B': 'Î’', 'C': 'Î“', 'D': 'Î”', 'E': 'Î•' };
    return map[latin] || latin;
  }

  function typesetMath(el = document.body) {
    if (!window.mathJaxReady) { setTimeout(() => typesetMath(el), 200); return; }
    MathJax.typesetClear([el]);
    MathJax.typesetPromise([el]).catch(() => {});
  }

  async function loadYearIfNeeded(year) {
    if (loadedYear === year && allQuestions.length > 0) return true;
    const url = DATA_URLS[year];
    if (!url) { alert('âŒ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Ï„Î¿ Î­Ï„Î¿Ï‚ ' + year); return false; }

    try {
      const resp = await fetch(url);
      if (!resp.ok) throw new Error('HTTP ' + resp.status);
      const data = await resp.json();

      allQuestions = data.map((q, i) => ({
        id: q.id ?? i + 1,
        year: String(q.year || year),
        school: String(q.school || ""),
        exam: String(q.exam || ""),
        subject: String(q.subject || "ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬"),
        topic: String(q.topic || ""),
        content: String(q.content || "")
      }));

      loadedYear = year;
      return true;
    } catch (e) {
      alert('âŒ Î ÏÏŒÎ²Î»Î·Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚: ' + e.message);
      return false;
    }
  }

  function getFilteredQuestions() {
    const y = document.getElementById("year").value;
    const s = document.getElementById("school").value;
    const sub = document.getElementById("subject").value;
    const t = document.getElementById("topic").value;

    return allQuestions.filter(q => {
      if (y && q.year !== y) return false;
      if (sub && !q.subject.includes(sub)) return false;
      if (t && !q.topic.toUpperCase().startsWith(t.toUpperCase())) return false;

      if (s) {
        if (s === "gel" && !(q.school === "gel" && q.exam !== "gel_repeat" && q.exam !== "omogeneis")) return false;
        if (s === "gel_repeat" && q.exam !== "gel_repeat") return false;
        if (s === "epal" && !(q.school === "epal" && q.exam !== "epal_repeat")) return false;
        if (s === "epal_repeat" && q.exam !== "epal_repeat") return false;
        if (s === "omogeneis" && !(q.school === "omogeneis" || q.exam === "omogeneis")) return false;
      }
      return true;
    });
  }

  /* Î Î±ÏÎ¬Î³ÏÎ±Ï†Î¿Î¹ + MathJax escapes */
  function formatContent(raw) {
    let s = String(raw ?? "");
    s = s.replace(/\\n/g, "\n").replace(/\r\n/g, "\n").replace(/\r/g, "\n");

    const firstLine = (s.split("\n")[0] || "").trim();
    if (/(Î Î‘ÎÎ•Î›Î›Î‘Î”Î™Îš|Î•Î Î‘ÎÎ‘Î›Î—Î Î¤Î™Îš|ÎŸÎœÎŸÎ“Î•ÎÎ•Î™Î£|Î•ÎÎ•Î¤Î‘Î£Î•Î™Î£|\(\s*\d{4}\s*[-â€“])/i.test(firstLine)) {
      s = s.substring(s.indexOf("\n") + 1);
    }

    s = s.trim();

    s = s
      .replace(/\\\\\(/g, '\\(').replace(/\\\\\)/g, '\\)')
      .replace(/\\\\\[/g, '\\[').replace(/\\\\\]/g, '\\]');

    const parts = s.split(/\n{2,}/);
    return parts.map(p => `<p class="exam-paragraph">${p.replace(/\n/g, "<br>")}</p>`).join("");
  }

  window.searchQuestions = async function() {
    const year = document.getElementById("year").value;
    if (!year) { alert("âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î­Ï„Î¿Ï‚"); return; }

    const grid = document.getElementById("questionsGrid");
    grid.innerHTML = '<div class="empty-state"><div class="empty-icon">â³</div><h3>Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</h3></div>';

    const ok = await loadYearIfNeeded(year);
    if (!ok) return;

    displayQuestions(getFilteredQuestions());
  };

  function displayQuestions(questions) {
    const grid = document.getElementById("questionsGrid");
    const info = document.getElementById("resultsInfo");
    const cnt = document.getElementById("resultsCount");

    if (!questions || questions.length === 0) {
      grid.innerHTML = '<div class="empty-state"><div class="empty-icon">âŒ</div><h3>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î¸Î­Î¼Î±Ï„Î±</h3></div>';
      info.style.display = "none";
      return;
    }

    cnt.textContent = questions.length;
    info.style.display = "block";

    grid.innerHTML = questions.map(q => {
      let schoolText = q.school.toUpperCase();
      if (q.school === "omogeneis" || q.exam === "omogeneis") schoolText = "ÎŸÎœÎŸÎ“Î•ÎÎ•Î™Î£";
      else if (q.school === "gel" && q.exam === "gel_repeat") schoolText = "Î“Î•Î› Î•Î Î‘ÎÎ‘Î›Î—Î Î¤Î™ÎšÎ•Î£";
      else if (q.school === "epal" && q.exam === "epal_repeat") schoolText = "Î•Î Î‘Î› Î•Î Î‘ÎÎ‘Î›Î—Î Î¤Î™ÎšÎ•Î£";

      return `
        <div class="question-card">
          <div class="card-header">
            <div class="card-badges">
              <span class="badge badge-year">${q.year}</span>
              <span class="badge badge-school">${schoolText}</span>
              <span class="badge badge-subject">${q.subject}</span>
            </div>
            <button class="btn btn-sm btn-outline" onclick="addToExam(${q.id})">âœ… Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
          </div>
          <div class="card-title">Î˜Î­Î¼Î± ${toGreekLetter(q.topic)}</div>
          <div class="card-content">${formatContent(q.content)}</div>
        </div>`;
    }).join("");

    setTimeout(() => typesetMath(grid), 250);
    setTimeout(() => typesetMath(grid), 900);
  }

  window.addToExam = function(id) {
    const q = allQuestions.find(x => x.id === id);
    if (!q) return;
    if (selectedQuestions.find(x => x.id === id)) { alert("âš ï¸ Î¤Î¿ Î¸Î­Î¼Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·!"); return; }
    selectedQuestions.push(q);
    renderMyExam();
  };

  window.removeFromExam = function(id) {
    const i = selectedQuestions.findIndex(x => x.id === id);
    if (i > -1) { selectedQuestions.splice(i, 1); renderMyExam(); }
  };

  function renderMyExam() {
    const panel = document.getElementById("myExamPanel");
    const info = document.getElementById("myExamInfo");
    const cnt = document.getElementById("myExamCount");

    if (selectedQuestions.length === 0) {
      panel.innerHTML = '<div class="empty-state"><div class="empty-icon">âœï¸</div><h3>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Î¸Î­Î¼Î±Ï„Î±</h3></div>';
      info.style.display = "none";
      return;
    }

    cnt.textContent = selectedQuestions.length;
    info.style.display = "block";

    let html = '<div style="padding:10px;">';
    selectedQuestions.forEach((q, i) => {
      let schoolText = q.school.toUpperCase();
      if (q.school === "omogeneis" || q.exam === "omogeneis") schoolText = "ÎŸÎœÎŸÎ“Î•ÎÎ•Î™Î£";
      else if (q.exam === "gel_repeat") schoolText = "Î“Î•Î› Î•Î Î‘ÎÎ‘Î›Î—Î Î¤Î™ÎšÎ•Î£";
      else if (q.exam === "epal_repeat") schoolText = "Î•Î Î‘Î› Î•Î Î‘ÎÎ‘Î›Î—Î Î¤Î™ÎšÎ•Î£";

      html += `
        <div style="margin:30px 0; padding-bottom:20px; border-bottom:1px solid #dee2e6;">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:12px;">
            <strong style="font-size:1.2em;">${i + 1}. Î˜Î­Î¼Î± ${toGreekLetter(q.topic)}</strong>
            <span style="color:#666; font-size:0.95em;">(${q.year} â€“ ${schoolText})</span>
            <button class="btn btn-sm btn-danger" onclick="removeFromExam(${q.id})">âŒ Î‘Ï†Î±Î¯ÏÎµÏƒÎ·</button>
          </div>
          <div class="card-content">${formatContent(q.content)}</div>
        </div>`;
    });
    html += '</div>';

    panel.innerHTML = html;

    setTimeout(() => typesetMath(panel), 250);
    setTimeout(() => typesetMath(panel), 900);
  }

  function buildShareUrl() {
    if (!selectedQuestions.length || !loadedYear) return location.href.split("?")[0];
    const ids = selectedQuestions.map(q => q.id).join(",");
    return location.href.split("?")[0] + `?questions=${ids}&year=${loadedYear}`;
  }

  window.generateQRCode = function() {
    if (!selectedQuestions.length) { alert("âš ï¸ Î ÏÏÏ„Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î¸Î­Î¼Î±Ï„Î±"); return; }
    const url = buildShareUrl();

    document.getElementById("qrcode").innerHTML = "";
    new QRCode(document.getElementById("qrcode"), {
      text: url,
      width: 220,
      height: 220,
      colorDark: "#0d47a1",
      colorLight: "#ffffff"
    });

    document.getElementById("shareUrl").textContent = url;
    document.getElementById("qrPanel").style.display = "block";
    document.getElementById("qrPanel").scrollIntoView({ behavior: "smooth" });
  };

  window.clearMyExam = () => {
    if (!confirm("Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ ÏŒÎ»Î± Ï„Î± Î¸Î­Î¼Î±Ï„Î±;")) return;
    selectedQuestions.length = 0;
    renderMyExam();
    document.getElementById("qrPanel").style.display = "none";
  };

  window.resetFilters = function() {
    document.getElementById("year").value = "";
    document.getElementById("school").value = "";
    document.getElementById("subject").value = "";
    document.getElementById("topic").value = "";
    document.getElementById("questionsGrid").innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><h3>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï†Î¯Î»Ï„ÏÎ±</h3></div>';
    document.getElementById("resultsInfo").style.display = "none";
  };

  // âœ… PDF export: ÎÎ•ÎŸ tab + Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹ MathJax + print dialog (Î³Î¹Î± Save as PDF)
  function buildExamHeaderHTML() {
    const yearTxt = (loadedYear || "").trim();
    const schoolSel = document.getElementById("school");
    const schoolTxt = schoolSel && schoolSel.value ? schoolSel.options[schoolSel.selectedIndex].text : "";
    const subjectSel = document.getElementById("subject");
    const subjectTxt = subjectSel && subjectSel.value ? subjectSel.value : "ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬";
    const now = new Date();
    const dateTxt = now.toLocaleDateString("el-GR", { year: "numeric", month: "2-digit", day: "2-digit" });

    return `
      <div style="width:100%; background:#fff; color:#111; font-family:Segoe UI, Tahoma, Verdana, sans-serif;">
        <div style="text-align:center; font-weight:800; font-size:15px;">Î•Î›Î›Î—ÎÎ™ÎšÎ— Î”Î—ÎœÎŸÎšÎ¡Î‘Î¤Î™Î‘</div>
        <div style="text-align:center; font-weight:800; font-size:14px; margin-top:2px;">Î Î‘ÎÎ•Î›Î›Î‘Î”Î™ÎšÎ•Î£ Î•ÎÎ•Î¤Î‘Î£Î•Î™Î£</div>

        <div style="margin-top:8px; border-top:2px solid #000; border-bottom:2px solid #000; padding:10px 0;">
          <div style="display:flex; justify-content:space-between; gap:14px; font-size:12px;">
            <div style="min-width:52%; line-height:1.45;">
              <div><strong>ÎœÎ¬Î¸Î·Î¼Î±:</strong> ${subjectTxt}</div>
              <div><strong>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±:</strong> ${dateTxt}</div>
              <div><strong>ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿:</strong> ............................................................</div>
              <div style="margin-top:6px;"><strong>Î£Ï‡Î¿Î»ÎµÎ¯Î¿:</strong> ............................................................</div>
            </div>
            <div style="min-width:48%; text-align:right; line-height:1.45;">
              ${yearTxt ? `<div><strong>ÎˆÏ„Î¿Ï‚:</strong> ${yearTxt}</div>` : ``}
              ${schoolTxt ? `<div><strong>Î¤ÏÏ€Î¿Ï‚:</strong> ${schoolTxt}</div>` : ``}
              <div><strong>Î˜Î­Î¼Î±Ï„Î±:</strong> ${selectedQuestions.length}</div>
            </div>
          </div>
        </div>

        <div style="margin-top:8px; font-size:11px; line-height:1.5;">
          <div><strong>ÎŸÎ´Î·Î³Î¯ÎµÏ‚:</strong></div>
          <div>â€¢ ÎÎ± Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ„Îµ ÏƒÎµ ÏŒÎ»Î± Ï„Î± Î¸Î­Î¼Î±Ï„Î±.</div>
          <div>â€¢ ÎÎ± Î±Î¹Ï„Î¹Î¿Î»Î¿Î³ÎµÎ¯Ï„Îµ Ï€Î»Î®ÏÏ‰Ï‚ Ï„Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÎ±Ï‚ ÏŒÏ€Î¿Ï… Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹.</div>
        </div>

        <div style="margin-top:10px; border-bottom:1px solid #000;"></div>
      </div>
    `;
  }

  function buildExamBodyHTML() {
    let html = '';
    selectedQuestions.forEach((q, i) => {
      let schoolText = q.school.toUpperCase();
      if (q.school === "omogeneis" || q.exam === "omogeneis") schoolText = "ÎŸÎœÎŸÎ“Î•ÎÎ•Î™Î£";
      else if (q.exam === "gel_repeat") schoolText = "Î“Î•Î› Î•Î Î‘ÎÎ‘Î›Î—Î Î¤Î™ÎšÎ•Î£";
      else if (q.exam === "epal_repeat") schoolText = "Î•Î Î‘Î› Î•Î Î‘ÎÎ‘Î›Î—Î Î¤Î™ÎšÎ•Î£";

      html += `
        <div style="margin-top:18px;">
          <div style="display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;">
            <div style="font-size:14px; font-weight:800;">${i+1}. Î˜Î­Î¼Î± ${toGreekLetter(q.topic)}</div>
            <div style="font-size:12px; color:#444;">(${q.year} â€“ ${schoolText})</div>
          </div>
          <div style="margin-top:6px; font-size:12.5px; line-height:1.75;">
            ${formatContent(q.content)}
          </div>
          <div style="margin-top:14px; border-bottom:1px solid #ddd;"></div>
        </div>
      `;
    });
    return html;
  }

  window.printMyExam = function() {
    if (!selectedQuestions.length) { alert("âš ï¸ Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î¸Î­Î¼Î±Ï„Î±"); return; }

    const w = window.open('', '_blank');
    if (!w) { alert("âŒ Î•Ï€Î¹Ï„ÏÎ­ÏˆÏ„Îµ Ï„Î± popups Î³Î¹Î± PDF export."); return; }

    const headerHTML = buildExamHeaderHTML();
    const bodyHTML = buildExamBodyHTML();

    // âš ï¸ Î£Î—ÎœÎ‘ÎÎ¤Î™ÎšÎŸ: Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ <\/script> Î³Î¹Î± Î½Î± ÎœÎ—Î ÎºÎ»ÎµÎ¯ÏƒÎµÎ¹ Ï„Î¿ <script> Ï„Î·Ï‚ ÎºÏÏÎ¹Î±Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚
    w.document.open();
    w.document.write(`
      <!doctype html>
      <html lang="el">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î”Î¹Î±Î³ÏÎ½Î¹ÏƒÎ¼Î± - EisatoponAI</title>

        <script>
          MathJax = {
            tex: {
              inlineMath: [['\\\\(', '\\\\)'], ['$', '$']],
              displayMath: [['\\\\[', '\\\\]'], ['$$', '$$']],
              processEscapes: true
            }
          };
        <\/script>
        <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>

        <style>
          html, body { background:#fff; color:#111; margin:0; padding:0; }
          body { font-family: Segoe UI, Tahoma, Verdana, sans-serif; padding: 14mm; }
          .exam-paragraph { margin: 10px 0; line-height: 1.75; }
          .created-by { position: fixed; left: 0; right: 0; bottom: 8mm; text-align: center; font-size: 11px; color: #555; }
          @page { margin: 14mm; }
        </style>
      </head>
      <body>
        ${headerHTML}
        <div style="margin-top:10px;">${bodyHTML}</div>
        <div class="created-by">Created by EisatoponAI - www.eisatopon.gr</div>

        <script>
          (function waitAndPrint() {
            if (typeof MathJax === 'undefined' || !MathJax.startup || !MathJax.startup.promise) {
              setTimeout(waitAndPrint, 300);
              return;
            }
            MathJax.startup.promise
              .then(() => MathJax.typesetPromise())
              .then(() => setTimeout(() => window.print(), 400))
              .catch(() => setTimeout(() => window.print(), 700));
          })();
        <\/script>
      </body>
      </html>
    `);
    w.document.close();
  };

  // Load from URL
  (async function loadFromUrl() {
    const params = new URLSearchParams(location.search);
    const ids = params.get("questions");
    const year = params.get("year");

    if (ids && year) {
      const ok = await loadYearIfNeeded(year);
      if (!ok) return;

      ids.split(",").forEach(idStr => {
        const id = parseInt(idStr, 10); // âœ… Ï€Î¬Î½Ï„Î± Î¼Îµ Î²Î¬ÏƒÎ· 10
        const q = allQuestions.find(x => x.id === id);
        if (q && !selectedQuestions.find(x => x.id === id)) selectedQuestions.push(q);
      });

      if (selectedQuestions.length > 0) {
        renderMyExam();
        document.getElementById("myExamPanel").scrollIntoView({ behavior: "smooth" });
      }
    }
  })();
</script>

</body>
</html>

